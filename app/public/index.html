<!DOCTYPE html>
<html>
    <head>
        <title>CARROOM</title>
        <h1>ENTER CAR DETAILS</h1>
        <style>
            table {
                border-collapse: collapse; 
                margin-top: 20px;          
            }
    
            table td, table th {
                border: 1px solid black;
                padding: 8px;            
            }
        </style>
    </head>
    <body>
        <label for="year-input">Year:</label>
        <input type="text" id="year-input">

        <label for="make-input">Make:</label>
        <input type="text" id="make-input">

        <label for="model-input">Model:</label>
        <input type="text" id="model-input">

        <button id="searchButton">Get Car</button>
        <p id="error-message" style="color:red;"></p>
        
    
        <table>
            <thead>
                <tr>
                    <th>Make</th>
                    <th>Model</th>
                    <th>Year</th>
                    <th>Fuel Type</th>
                    <th>Drivetrain</th>
                    <th>Cylinders</th>
                    <th>Transmission</th>
                    <th>City MPG</th>
                    <th>Highway MPG</th>
                    <th>Combination MPG</th>
                    
                </tr>
            </thead>
            <tbody id="car-table-body">
            </tbody>
        </table>
    
        <script>
            let carButton = document.getElementById("searchButton");
            
            
            carButton.addEventListener("click", () => {
                yearInput = document.getElementById("year-input").value;
                makeInput = document.getElementById("make-input").value;
                modelInput = document.getElementById("model-input").value;

                errorMessageElement = document.getElementById("error-message");
                tableBodyElement = document.getElementById("car-table-body");
    
                while(tableBodyElement.firstChild) {
                    tableBodyElement.removeChild(tableBodyElement.firstChild);
                }
                errorMessageElement.textContent = "";
    
                fetch(`/cars?year=${yearInput}&make=${makeInput}&model=${modelInput}`)
                    .then(response => {
                        if(response.ok) {
                            return response.json();
                        } else {
                            if(response.status === 404) {
                                throw { message: "Car not found" };
                            }
                            return response.json().then(error => { throw error });
                        }
                    })
                    .then(data => {
                        data.forEach(cars => {
                            row = document.createElement("tr");
    
                            makeCell = document.createElement("td");
                            makeCell.textContent = cars.make;
                            row.appendChild(makeCell);
    
                            modelCell = document.createElement("td");
                            modelCell.textContent = cars.model;
                            row.appendChild(modelCell);
    
                            yearCell = document.createElement("td");
                            yearCell.textContent = cars.year;
                            row.appendChild(yearCell);

                            fuelTypeCell = document.createElement("td");
                            fuelTypeCell.textContent = cars.fuel_type;
                            row.appendChild(fuelTypeCell);

                            driveCell = document.createElement("td");
                            driveCell.textContent = cars.drive;
                            row.appendChild(driveCell);

                            cylinderCell = document.createElement("td");
                            cylinderCell.textContent = cars.cylinders;
                            row.appendChild(cylinderCell);


                            transCell = document.createElement("td");
                            transCell.textContent = cars.transmission;
                            row.appendChild(transCell);

                            cityMPGCell = document.createElement("td");
                            cityMPGCell.textContent = cars.city_mpg;
                            row.appendChild(cityMPGCell);

                            hwyMPGCell = document.createElement("td");
                            hwyMPGCell.textContent = cars.highway_mpg;
                            row.appendChild(hwyMPGCell);

                            combMPGCell = document.createElement("td");
                            combMPGCell.textContent = cars.combination_mpg;
                            row.appendChild(combMPGCell);

    
                            tableBodyElement.appendChild(row);
                        });
                    })
                    .catch(error => {
                        errorMessageElement.textContent = error.message || 'An error occurred while fetching the car.';
                    });
            })
            
        
        </script>
    </body>
</html>